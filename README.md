# Analyzing the Time x Energy Relation in C++ Solutions Mined from a Programming Contest Site

## What is this?

This repository contains the source code of C++ solutions mined from the Code Submission Evaluation System (CSES).

It contains folders related to 15 different CSES problems, where each folder contains 30 different C++ solutions. The complete list of CSES problems is available in [CSES_problems](/CSES_problems.md).


## Folder Structure

The main folder contains 17 subfolders: 
1. 15 subfolders (one for each CSES problem).
2. A subfolder `RAPL`, which contains the code related to the time/energy measurement framework.
This code is mostly based on the one provided by the [Green Software Lab](https://github.com/greensoftwarelab/Energy-Languages).
3. A subfolder `analysis-script`, which contains Python scripts to analyze the data generated by the time/energy measuring tool. 

Each folder related to a CSES problem has a `Makefile`, a subfolder `test`, with input files related to the problem, and the subfolders `slow`, `fast` and `rand`, which contain C++ solutions for the given problem.
Subfolder `slow` has the 10 slowest C++ solutions, while subfolder `fast` has the 10 fastest ones,
and subfolder `rand` has 10 C++ solutions chosen at random.

Moreover, in the folder of each CSES problem there are the following files related to energy measurements
performed in two different machines (*HPELITE* and *HPTHINK*) by using different C++ flags (-O0, -O2 and -Os):
- 1621-HPELITE-O0.csv
- 1621-HPELITE-O2.csv
- 1621-HPELITE-Os.csv
- 1621-HPTHINK-O0.csv
- 1621-HPTHINK-O2.csv
- 1621-HPTHINK-Os.csv


## Compiling/Running the C++ Solutions

The files in this repository were compiled in a Linux/Ubuntu environment
using versions of the `g++` compiler with support to the **C++17** standard.

To start measuring the time/energy of the CSES solutions, the first step is to compile the measurement framework.
You should enter the `RAPL` folder and type `make`.

After this, you should enter a folder related to a CSES problem (e.g., *cses-1084_Apartments*) and type `make`.
This will compile and run all solutions for the given problem in the associated `slow`, `fast` and `rand` subfolders.

After compiling a solution, and before running it, the following command will also be executed:
```
sudo modprobe msr
```

Such command enables us to read the RAPL energy measurements.

When executing the outermost `Makefile` of a given problem, each solution of each subfolder
(`slow`, `fast` and `rand`) will be compiled and then executed for each test file of the
corresponding `test` subfolder. By default, we will run each solution ten times against
the corresponding testset.

The energy measurements of the solutions for a given problem will be stored in a .csv file
whose name can be configured by changing the value of the variable `PROBLEM` in the
first line of the corresponding outermost `Makefile`. By default, the results for a problem whose
number is X will be saved in a file `X.csv`. For example, the energy measurements for
*cses-1084_Apartments* will be stored in a file `1084.csv`.

Each line of the .csv containg six columns related to the following information:

Name of the executable file , PKG (Joules) , CPU (J) , GPU (J) , DRAM (J) , Time (ms)

RAPL will also report values for the columns PKG and CPU, but the measurements related
to GPU and DRAM may not be available in some machines.



## Using the Analysis Script

To use the analysis script, enter in the folder of a problem and type the following command:
```
python ../analysis-script/analisacsvs.py <file>.csv
```

You can also provide multiple .csv files to the analysis script. In this case, you should provide
an even number **2 * N** of files. The script will consider that the first **N** files
are related to a machine, while the others are related to a different machine, and it will
compare the outliers in files **1, 2, ..., N** with the outliers in files **N+1, N+2, ..., N+N**.

The analysis script creates a subfoder `analysis_results` where it will store several
auxiliary files generated during the analysis.

## Suggested Reading 

The paper **Analyzing the Time x Energy Relation in C++ Solutions Mined from a Programming Contest Site**,
by Sérgio Queiroz de Medeiros, Marcelo Borges Nogueira and Gustavo Quezado, from the 
27th Brazilian Symposium on Programming Languages (SBLP'2023), 
discusses an experiment based on the data available in this repository.



## Contact

You can contact [@Sérgio Medeiros](http://github.com/sqmedeiros)
and [@Marcelo Nogueira](https://github.com/borgesnogueira) about this repository.


